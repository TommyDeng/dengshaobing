<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="base :: common_header(~{::title},~{::link})">
</head>
<script type="text/javascript" th:inline="javascript">
	function changeItemQty(cartItemUC, itemPrice, countInput) {
		var itemCount = $(countInput).val();
		$.post("changeCartItemQty", {
			cartItemUC : cartItemUC,
			AT : [[${AT}]],
			itemCount : itemCount
		}, function(resultVar) {
			var targetRefreshItem = $(countInput).parent().siblings().last();
			targetRefreshItem.fadeToggle('fast');
			targetRefreshItem.html((resultVar * itemPrice).toFixed(1));
			targetRefreshItem.fadeToggle('fast');
		});

		//		var itemCount = $(countInput).val();
		// 		var url = 'changeCartItemQty?AT='+[[${AT}]]+'&cartItemUC='+cartItemUC+'&itemCount='+itemCount;
		// 		$("#cart-table").load(url);
	}
	
	function calcTotalAmount(){
		var total = 0;
		$("[data-calc]").each(function(index,element){
			console.info(element.attr("data-calc"));
// 			total+=element.html();
		});
		console.info(total);
	}
	
	$(document).ready(function() {
		calcTotalAmount();
	});
</script>
<body class="shop-main-page-body">
	<div th:insert="/eggshop/common/fragment :: shop-header"></div>
	<div class="container">
		<form role="form" th:object="${cartList}">
			<th:block id="cart-block">
				<table class="table table-striped table-sm">
					<thead>
						<tr>
							<th>#</th>
							<th>NAME</th>
							<th>PRICE</th>
							<th>COUNT</th>
							<th>SUM</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="record : *{dataList}">
							<td><label class="custom-control custom-checkbox"> <input
									type="checkbox" class="custom-control-input"
									th:field="*{checkedList}" th:value="${record.UNIQUE_CODE}" />
									<span class="custom-control-indicator"></span> <span
									class="custom-control-description"
									th:text="${recordStat.count}"> 1</span>
							</label></td>

							<td><a th:text="${record.NAME}"
								th:href="@{itemdetail(productUC=${record.PRODUCT_UC},AT=${AT},previousPage=${previousPage})}"></a>
							</td>

							<td th:text="${record.PRICE}"></td>

							<td><input type="number" th:value="${record.PRODUCT_COUNT}"
								style="width: 80px"
								th:onchange="'changeItemQty(\''+${record.UNIQUE_CODE}+'\',\''+${record.PRICE}+'\',this);'"></input>
							</td>
							<td th:data-calc="${record.SUM_AMOUNT}" th:text="${record.SUM_AMOUNT}"></td>
						</tr>
					</tbody>
				</table>
				<div class="container">
					<div th:replace="/eggshop/common/fragment :: cart-preorder-footer"></div>
				</div>
			</th:block>
		</form>
	</div>

	<div th:insert="/eggshop/common/fragment :: shop-footer(3)"></div>
</body>
</html>