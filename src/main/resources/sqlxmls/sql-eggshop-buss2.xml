<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<sqls>
	<sql name="ES_BUSS001">
	<![CDATA[
SELECT t.PRODUCT_UC ,m.PATH FROM ES_MAIN_SWIPER t,
SYS_FILE_STORE_MAPPING m 
where t.THUMBNAIL = m.UNIQUE_CODE
and  (t.VALID_TIME is null or t.VALID_TIME > sysdate)
order by ORDER_NUM 
LIMIT 10
	]]>
	</sql>

	<sql name="ES_BUSS002">
	<![CDATA[
SELECT p.UNIQUE_CODE ,p.NAME ,m.PATH ,count(1) SALECOUNT FROM ES_PRODUCT p left join ES_ORDER_ITEM i on p.UNIQUE_CODE =i.PRODUCT_UC 
left join SYS_FILE_STORE_MAPPING m on p.THUMBNAIL =m.UNIQUE_CODE 
group by p.UNIQUE_CODE 
order by salecount desc
LIMIT 5
	]]>
	</sql>

	<sql name="ES_BUSS003">
	<![CDATA[
SELECT p.UNIQUE_CODE ,p.NAME ,p.BRIEF , m.PATH FROM ES_PRODUCT p 
left join SYS_FILE_STORE_MAPPING m on p.THUMBNAIL =m.UNIQUE_CODE 
order by p.CREATE_TIME desc
LIMIT 15
	]]>
	</sql>

	<sql name="ES_BUSS004">
	<![CDATA[
SELECT c.UNIQUE_CODE, c.NAME ,c.REMARK ,m.PATH  FROM ES_PRODUCT_CATEGORY c 
left join SYS_FILE_STORE_MAPPING m on c.THUMBNAIL = m.UNIQUE_CODE 
order by c.ORDER_NUM 
	]]>
	</sql>

	<sql name="ES_BUSS005">
	<![CDATA[
SELECT P.UNIQUE_CODE ,P.NAME ,P.BRIEF , M.PATH
FROM ES_PRODUCT P 
LEFT JOIN ES_PRODUCT_CATEGORY C ON P.CATEGORY  = C.UNIQUE_CODE 
LEFT JOIN SYS_FILE_STORE_MAPPING M ON P.THUMBNAIL =M.UNIQUE_CODE 
WHERE P.CATEGORY = :CATEGORY OR :CATEGORY IS NULL
LIMIT 100
	]]>
	</sql>

	<sql name="ES_BUSS006">
	<![CDATA[
SELECT p.UNIQUE_CODE  ,p.NAME ,p.PRICE, p.CATEGORY, p.BRIEF, p.DETAIL_DESCIPTION, p.CREATE_TIME
  FROM ES_PRODUCT p
 where p.UNIQUE_CODE = :UNIQUE_CODE
 	]]>
	</sql>

	<sql name="ES_BUSS007">
	<![CDATA[
SELECT PRODUCT_COUNT
  FROM ES_SHOPPING_CART
 where USER_UC = :USER_UC
   and PRODUCT_UC = :PRODUCT_UC
   	]]>
	</sql>

	<sql name="ES_BUSS008">
	<![CDATA[
MERGE INTO ES_SHOPPING_CART(UNIQUE_CODE, USER_UC, PRODUCT_UC, PRODUCT_COUNT)
 KEY(USER_UC, PRODUCT_UC)
values(:UNIQUE_CODE, :USER_UC, :PRODUCT_UC, :PRODUCT_COUNT)
   	]]>
	</sql>

	<sql name="ES_BUSS009">
	<![CDATA[
SELECT nvl(sum(PRODUCT_COUNT),0) FROM ES_SHOPPING_CART where USER_UC  = :USER_UC 
	]]>
	</sql>

	<sql name="ES_BUSS010">
	<![CDATA[
SELECT SELECTED,
	   S.UNIQUE_CODE AS UNIQUE_CODE,
       P.UNIQUE_CODE AS PRODUCT_UC,
       P.NAME,
       P.PRICE,
       CONVERT(S.PRODUCT_COUNT, INT) PRODUCT_COUNT,
       TRUNCATE(P.PRICE * S.PRODUCT_COUNT,2) SUB_AMT
  FROM ES_SHOPPING_CART S, ES_PRODUCT P
 WHERE S.PRODUCT_UC = P.UNIQUE_CODE
   AND S.USER_UC = :USER_UC
   ORDER BY S.CREATE_TIME DESC
	]]>
	</sql>

	<sql name="ES_BUSS011">
	<![CDATA[
UPDATE ES_SHOPPING_CART SET SELECTED = DECODE(SELECTED,TRUE,FALSE,TRUE) WHERE UNIQUE_CODE = :UNIQUE_CODE
	]]>
	</sql>

	<sql name="ES_BUSS012">
	<![CDATA[
UPDATE ES_SHOPPING_CART SET SELECTED = :SELECTED WHERE USER_UC = :USER_UC
	]]>
	</sql>

	<sql name="ES_BUSS013">
	<![CDATA[
SELECT t.UNIQUE_CODE ,t.RECEIVER_NAME ,t.PROVINCE ||t.CITY ||t.DISTRICT ||t.ADDRESS as DELIVERY_ADDRESS ,t.CONTACT  FROM ES_DELIVERY_ADDRESS t 
	where t.USER_UC =:USER_UC
	order by t.LAST_SELECT_TIME desc
	]]>
	</sql>
	<sql name="ES_BUSS014">
	<![CDATA[
SELECT p.NAME PRODUCT_NAME,CONVERT(t.PRODUCT_COUNT,INT) PRODUCT_COUNT, TRUNCATE(p.PRICE * t.PRODUCT_COUNT,2) SUB_AMT
  FROM ES_SHOPPING_CART t,ES_PRODUCT p where t.PRODUCT_UC = p.UNIQUE_CODE and t.SELECTED = TRUE and t.USER_UC = :USER_UC 
	]]>
	</sql>

	<sql name="ES_BUSS015">
	<![CDATA[
insert into ES_ORDER_ITEM (ORDER_UC ,PRODUCT_UC ,PRODUCT_COUNT ,PRODUCT_PRICE ,SUB_AMT  )
select :ORDER_UC as ORDER_UC ,p.UNIQUE_CODE as PRODUCT_UC ,c.PRODUCT_COUNT as PRODUCT_COUNT ,p.PRICE  as PRODUCT_PRICE , p.PRICE * c.PRODUCT_COUNT as SUB_AMT  from ES_SHOPPING_CART c ,ES_PRODUCT p
where c.PRODUCT_UC = p.UNIQUE_CODE 
and c.SELECTED = TRUE
and c.USER_UC = :USER_UC
	]]>
	</sql>
	<sql name="ES_BUSS016">
	<![CDATA[
insert into ES_ORDER (UNIQUE_CODE ,USER_UC ,SUMMARY ,TOTAL_AMT ,RECEIVER_NAME ,PROVINCE ,CITY ,DISTRICT ,ADDRESS ,CONTACT ,PAYMENT_TYPE ,STATUS)
select :ORDER_UC as UNIQUE_CODE , :USER_UC as USER_UC ,'' as SUMMARY ,i.TOTAL_AMT as TOTAL_AMT,d.RECEIVER_NAME ,d.PROVINCE ,d.CITY ,d.DISTRICT ,d.ADDRESS ,d.CONTACT ,:PAYMENT_TYPE as PAYMENT_TYPE ,:STATUS as STATUS
 from (select sum(SUB_AMT) as TOTAL_AMT from ES_ORDER_ITEM where ORDER_UC = :ORDER_UC ) i,
ES_DELIVERY_ADDRESS d
where d.UNIQUE_CODE  = :ADDRESS_UC
and i.TOTAL_AMT is not null
	]]>
	</sql>

	<sql name="ES_BUSS017">
	<![CDATA[
update ES_DELIVERY_ADDRESS set LAST_SELECT_TIME = sysdate where UNIQUE_CODE =:UNIQUE_CODE 
	]]>
	</sql>
	<sql name="ES_BUSS018">
	<![CDATA[
delete from ES_SHOPPING_CART  where USER_UC = :USER_UC  and SELECTED = TRUE
	]]>
	</sql>

	<sql name="ES_BUSS019">
	<![CDATA[
select UNIQUE_CODE,
       SUMMARY,
       TOTAL_AMT,
       RECEIVER_NAME,
       STATUS,
       RECEIVER_NAME ,PROVINCE ||CITY ||DISTRICT ||ADDRESS as DELIVERY_ADDRESS ,CONTACT,
       to_char(CREATE_TIME, 'yyyy-MM-dd hh:mm:ss') as CREATE_TIME
  from ES_ORDER
 where (USER_UC = :USER_UC or :USER_UC is null)
 and (STATUS = :STATUS or :STATUS is null)
   order by CREATE_TIME desc
	]]>
	</sql>
	<sql name="ES_BUSS020">
	<![CDATA[
SELECT p.NAME PRODUCT_NAME,CONVERT(t.PRODUCT_COUNT,INT) PRODUCT_COUNT, TRUNCATE(p.PRICE * t.PRODUCT_COUNT,2) SUB_AMT
  FROM ES_ORDER_ITEM t,ES_PRODUCT p 
  where t.PRODUCT_UC = p.UNIQUE_CODE 
	and t.ORDER_UC = :ORDER_UC
	]]>
	</sql>

	<sql name="ES_BUSS021">
	<![CDATA[
SELECT c.UNIQUE_CODE, p.NAME ,c.REMARK ,m.PATH,c.VALID_TIME   FROM ES_MAIN_SWIPER c 
left join SYS_FILE_STORE_MAPPING m on c.THUMBNAIL = m.UNIQUE_CODE 
left join ES_PRODUCT p on c.PRODUCT_UC = p.UNIQUE_CODE 
order by c.ORDER_NUM 
	]]>
	</sql>
	
	<sql name="ES_BUSS022">
	<![CDATA[
SELECT P.UNIQUE_CODE ,P.NAME ,P.PRICE , C.NAME as CATEGORY_NAME,P.CREATE_TIME 
 FROM ES_PRODUCT P 
LEFT JOIN ES_PRODUCT_CATEGORY C ON P.CATEGORY  = C.UNIQUE_CODE 
	]]>
	</sql>

	<sql name="ES_BUSS023">
	<![CDATA[
SELECT m.UNIQUE_CODE ,m.PRODUCT_UC ,m.ORDER_NUM ,f.PATH  ,m.MEDIA_TYPE,m.CREATE_TIME  
 FROM ES_PRODUCT_MEDIA m left join SYS_FILE_STORE_MAPPING f on m.THUMBNAIL = f.UNIQUE_CODE 
WHERE m.PRODUCT_UC = :PRODUCT_UC order by m.ORDER_NUM 
	]]>
	</sql>
	
	<sql name="ES_BUSS024">
	<![CDATA[
	update ES_ORDER set PAYMENT_UC = :PAYMENT_UC where UNIQUE_CODE = :UNIQUE_CODE
	]]>
	</sql>
	
	<sql name="ES_BUSS025">
	<![CDATA[
	select p.* from ES_ORDER o, ES_PAYMENT p where o.PAYMENT_UC = p.UNIQUE_CODE and o.UNIQUE_CODE = :UNIQUE_CODE
	]]>
	</sql>

	<sql name="ES_BUSS026">
	<![CDATA[
	update ES_ORDER  set STATUS = :STATUS  where exists (select 1 from ES_PAYMENT p where PAYMENT_UC = p.UNIQUE_CODE and p.OUT_TRADE_NO = :OUT_TRADE_NO)
	]]>
	</sql>
	
	
	
</sqls>